@page
@inject BasketService ThisBasketService
@model HttpWebshopCookie.Pages.Products.IndexAltModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

@if (!string.IsNullOrEmpty(TempData["SuccessMessage"] as string))
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}

@if (!ModelState.IsValid)
{
    <div class="alert alert-danger">
        @Html.ValidationSummary()
    </div>
}

<div class="container">
    <h1>Products</h1>
    <form method="get" class="p-1 bg-primary-subtle d-flex justify-content-between">
        <div class="d-flex justify-content-evenly">
            <label class="col-form-label-lg pe-2 ps-2">Sort by</label>
            <select class="form-select form-control-sm" name="sortBy">
                <option value="Name" selected="@Model.SortBy == "Name"">Name</option>
                <option value="Price" selected="@Model.SortBy == "Price"">Price</option>
            </select>
            <select class="form-select form-control-sm" name="sortOrder">
                <option value="Ascending" selected="@Model.SortOrder == "Ascending"">Ascending</option>
                <option value="Descending" selected="@Model.SortOrder == "Descending"">Descending</option>
            </select>
            <select class="form-select form-control-sm" name="pageSize">
                <option value="9" selected="@Model.PageSize == 9">9 per page</option>
                <option value="18" selected="@Model.PageSize == 18">18 per page</option>
                <option value="27" selected="@Model.PageSize == 27">27 per page</option>
                <option value="36" selected="@Model.PageSize == 36">36 per page</option>
            </select>
            <input type="text" class="form-control" name="searchTerm" placeholder="Search products..." value="@Model.SearchTerm" />
            <button class="btn btn-outline-primary" type="submit">Search</button>
            <button class="btn btn-outline-danger" type="reset">Reset</button>
        </div>
    </form>

    <table class="table table-hover table-striped">
        <thead class="table-primary">
            <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Description</th>
                <th scope="col">Tags</th>
                <th scope="col">Quantity</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model.ProductList)
            {
                <tr>
                    <td>@product.Name</td>
                    <td>@product.Price</td>
                    <td>@product.Description</td>
                    <td>
                        @foreach (var tag in product.Tags)
                        {
                            <span class="badge bg-primary">@tag.Category - @tag.SubCategory</span>
                        }
                    </td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-sm" asp-page-handler="ModifyBasket" asp-route-productId="@product.Id" asp-route-addItem="@true">Add</button>
                            <button class="btn btn-warning btn-sm" asp-page-handler="ModifyBasket" asp-route-productId="@product.Id" asp-route-addItem="@false" disabled="@(Model.ProductQuantities[product.Id!] <= 0 ? "disabled" : null)">Remove</button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <nav aria-label="Product navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item @(Model.PageIndex > 1 ? "" : "disabled")">
                <a class="page-link" href="?pageIndex=@(Model.PageIndex - 1)&pageSize=@Model.PageSize&searchTerm=@Model.SearchTerm">Previous</a>
            </li>
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                    <a class="page-link" href="?pageIndex=@i&pageSize=@Model.PageSize&searchTerm=@Model.SearchTerm">@i</a>
                </li>
            }
            <li class="page-item @(Model.PageIndex < Model.TotalPages ? "" : "disabled")">
                <a class="page-link" href="?pageIndex=@(Model.PageIndex + 1)&pageSize=@Model.PageSize&searchTerm=@Model.SearchTerm">Next</a>
            </li>
        </ul>
    </nav>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-message="@TempData["Message"]">
        <div class="toast-header">
            <strong class="me-auto">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            @TempData["Message"]
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var message = document.querySelector('.toast')?.getAttribute('data-message');
            if (message) {
                var toastElement = document.querySelector('.toast');
                var toast = new bootstrap.Toast(toastElement);
                toast.show();
            }
        });
    </script>
}